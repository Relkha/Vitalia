{% extends "base.html" %}
{% load static %}

{% block title %}Tableau de bord - Vitalia{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{% static 'vitalia_app/css/dashboard.css' %}">
{% endblock %}

{% block content %}
<main class="container mt-4">
  <h2>Bienvenue, {{ user.username }} ({{ role }})</h2>

  <!-- ğŸ›‘ Alertes rÃ©centes -->
  <section class="dashboard-section">
    <h3>ğŸ“¢ Alertes rÃ©centes</h3>
    {% if recent_alerts %}
      <div class="recent-alerts">
        {% for alert in recent_alerts %}
          <div class="alert-card priority-{{ alert.priority|lower }}">
            <h4>{{ alert.title }}</h4>
            <p>{{ alert.description }}</p>
            <p class="alert-meta">
              <span>{{ alert.created_at|date:"d/m/Y H:i" }}</span>
              <span>{{ alert.get_priority_display }}</span>
            </p>
            <a href="{% url 'alertes_dashboard' %}" class="btn btn-sm">Voir toutes les alertes</a>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p>Aucune alerte rÃ©cente</p>
    {% endif %}
  </section>

  <!-- ğŸ‘¥ Gestion utilisateurs / Compte / Messages -->
  {% if is_admin or is_directeur %}
    <section class="dashboard-section">
      <h3>ğŸ‘¥ Gestion administrative</h3>
      <div class="card"><h4>GÃ©nÃ©rateur d'alertes</h4><a href="{% url 'generate_test_alert' %}" class="btn">Tester</a></div>
      <div class="card"><h4>Administration</h4><a href="/admin" class="btn">GÃ©rer</a></div>
      <div class="card"><h4>Messages</h4><a href="{% url 'message_admin' %}" class="btn">Voir</a></div>
    </section>
  {% endif %}

  <!-- ğŸ—“ï¸ Planning personnel / infirmiers / rÃ©sidents -->
  <section class="dashboard-section">
    <h3>ğŸ—“ï¸ Planning</h3>
    {% if is_admin or is_directeur or is_chef_infirmier %}
      <div class="card"><h4>Planning personnel</h4><a href="{% url 'event_list' %}" class="btn">CrÃ©er</a></div>
    {% elif is_infirmier or is_aide_soignant or is_menage %}
      <div class="card"><h4>Mon planning</h4><a href="{% url 'planning_individuel' %}" class="btn">Voir</a></div>
    {% endif %}

    {% if is_admin or is_directeur or is_chef_infirmier or is_infirmier %}
      <div class="card"><h4>Planning rÃ©sidents</h4><a href="{% url 'planning_residents' %}" class="btn">Voir</a></div>
    {% elif is_retraite %}
      <div class="card"><h4>Mon agenda</h4><a href="{% url 'mon_planning_resident' %}" class="btn">Voir</a></div>
    {% endif %}
  </section>

  <!-- ğŸ  Chambres et objets connectÃ©s -->
  <section class="dashboard-section">
    <h3>ğŸ  Chambres & Objets</h3>
    {% if is_admin or is_directeur or is_chef_infirmier or is_infirmier or is_aide_soignant or is_menage or is_retraite %}
      <div class="card"><h4>Chambres</h4><a href="{% url 'liste_chambres' %}" class="btn">AccÃ©der</a></div>
    {% endif %}

    {% if is_admin or is_directeur or is_chef_infirmier or is_infirmier or is_menage or is_retraite %}
      <div class="card"><h4>Objets connectÃ©s</h4><a href="{% url 'index' %}" class="btn">GÃ©rer / Consulter</a></div>
    {% endif %}
  </section>

  <!-- ğŸ©º Dossier mÃ©dical -->
  <section class="dashboard-section">
    <h3>ğŸ©º Dossiers mÃ©dicaux</h3>
    {% if is_admin or is_directeur or is_chef_infirmier or is_infirmier %}
      <div class="card"><h4>Dossiers patients</h4><a href="{% url 'dossiers_medical' %}" class="btn">Consulter</a></div>
    {% elif is_infirmier or is_chef_infirmier %}
      <div class="card"><h4>Notes mÃ©dicales</h4><a href="{% url 'dossiers_medical' %}" class="btn">Ajouter</a></div>
    {% elif is_aide_soignant or is_chef_infirmier or is_infirmier %}
      <div class="card"><h4>Observations</h4><a href="{% url 'dossiers_medical' %}" class="btn">Voir</a></div>
    {% endif %}
  </section>

  <!-- ğŸš¨ Surveillance et alertes -->
  <section class="dashboard-section">
    <h3>ğŸš¨ SÃ©curitÃ© & Surveillance</h3>
    {% if is_admin or is_directeur or is_chef_infirmier or is_infirmier or is_aide_soignant %}
      <div class="card"><h4>Alertes</h4><a href="{% url 'alertes_dashboard' %}" class="btn">AccÃ©der</a></div>
    {% endif %}

    {% if is_reception or is_directeur or is_responsable_site or is_infirmier or is_retraite %}
      <div class="card"><h4>Surveillance</h4><a href="{% url 'surveillance' %}" class="btn">CamÃ©ras</a></div>
    {% endif %}

    {% if is_admin or is_directeur or is_chef_infirmier or is_reception or is_infirmier %}
      <div class="card"><h4>Surveillance des chambres</h4><a href="{% url 'surveillance' %}" class="btn">Voir les capteurs</a></div>
    {% endif %}
  </section>

  <!-- ğŸ‘¥ Visites -->
  {% if is_reception or is_visiteur_resident or is_retraite %}
    <section class="dashboard-section">
      <h3>ğŸ‘¥ Visites</h3>
      <div class="card"><h4>RÃ©servations</h4><a href="{% url 'reservation_visite' %}" class="btn">Voir / RÃ©server</a></div>
    </section>
  {% endif %}

  <!-- ğŸ”” Notifications -->
  {% if user.is_authenticated %}
    <section class="dashboard-section">
      <h3>ğŸ”” Notifications</h3>
      <div class="card"><h4>Mes notifications</h4><a href="{% url 'notifications' %}" class="btn">Voir tout</a></div>
    </section>
  {% endif %}
</main>

{% endblock %}

{% block extra_js %}
<script src="{% static 'vitalia_app/js/notifications.js' %}"></script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    initNotificationSystem();
  });
</script>
{% endblock %}
